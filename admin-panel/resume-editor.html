<body class="bg-stone-200 dark:bg-zinc-900 text-zinc-800 dark:text-white font-sans leading-relaxed px-6 pb-20 max-w-4xl mx-auto">

  <h1 class="text-3xl font-bold text-center mt-12 mb-8">Edit Resume</h1>

  <div id="editor" class="space-y-12"></div>

  <div class="text-center mt-12">
    <button id="saveBtn" class="px-6 py-3 rounded-lg bg-orange-600 hover:bg-orange-700 dark:bg-orange-700 dark:hover:bg-orange-400 text-white font-bold transition-colors duration-500">
      Save Changes
    </button>
  </div>

<!-- Firebase Core -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>

<script>
  // === FIREBASE SETUP ===
  const firebaseConfig = {
    apiKey: "AIzaSyBYYAjY8Q7RH0jQuMeOmAAp3XPTGLAQr0k",
    authDomain: "code-tools-pastebin.firebaseapp.com",
    projectId: "code-tools-pastebin",
    storageBucket: "code-tools-pastebin.appspot.com",
    messagingSenderId: "1000713658548",
    appId: "1:1000713658548:web:4996a3a58b1f3fd013b7e1"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  const auth = firebase.auth();

  const editor = document.getElementById('editor');
  const saveBtn = document.getElementById('saveBtn');

  let resumeData = {
    summary: "",
    experience: [],
    skills: [],
    education: [],
    contact: {
      email: "",
      phone: "",
      telegram: "",
      web: ""
    }
  };

  // === LOADING EXISTING DATA IF AVAILABLE ===
  auth.signInAnonymously().then(() => {
    db.collection('resume').doc('live').get()
      .then(doc => {
        if (doc.exists) {
          resumeData = doc.data();
        }
        renderEditor();
      })
      .catch(err => {
        console.error("Failed to load resume:", err);
        renderEditor(); // Still render blank editor
      });
  }).catch(err => {
    console.error("Auth error:", err);
  });

  // === RENDER EDITOR ===
  function renderEditor() {
    editor.innerHTML = "";

    // Summary
    const summarySection = createSectionCard("Professional Summary");
    const summaryInput = makeInput(resumeData.summary, "Summary");
    summarySection.appendChild(summaryInput);
    editor.appendChild(summarySection);

    // Experience
    const expSection = createSectionCard("Relevant Experience");
    const expContainer = document.createElement('div');
    expSection.appendChild(expContainer);
    const addJob = createButton("+ Add Job", () => addExperience(expContainer));
    expSection.appendChild(addJob);
    editor.appendChild(expSection);
    (resumeData.experience || []).forEach(exp => addExperience(expContainer, exp));

    // Skills
    const skillsSection = createSectionCard("Skills");
    const skillsContainer = document.createElement('div');
    skillsSection.appendChild(skillsContainer);
    const addSkillGroup = createButton("+ Add Skill Group", () => addSkillGroupFunc(skillsContainer));
    skillsSection.appendChild(addSkillGroup);
    editor.appendChild(skillsSection);
    (resumeData.skills || []).forEach(skillGroup => addSkillGroupFunc(skillsContainer, skillGroup));

    // Education
    const eduSection = createSectionCard("Education");
    const eduContainer = document.createElement('div');
    eduSection.appendChild(eduContainer);
    const addEduGroup = createButton("+ Add Education Group", () => addEduGroupFunc(eduContainer));
    eduSection.appendChild(addEduGroup);
    editor.appendChild(eduSection);
    (resumeData.education || []).forEach(eduGroup => addEduGroupFunc(eduContainer, eduGroup));

    // Contact
    const contactSection = createSectionCard("Contact");
    contactSection.appendChild(makeInput(resumeData.contact.email, "Email"));
    contactSection.appendChild(makeInput(resumeData.contact.phone, "Phone"));
    contactSection.appendChild(makeInput(resumeData.contact.telegram, "Telegram"));
    contactSection.appendChild(makeInput(resumeData.contact.web, "Website"));
    editor.appendChild(contactSection);
  }

  // === UTILITIES ===
  function createSectionCard(title) {
    const div = document.createElement('div');
    div.className = "section-card space-y-4";
    div.innerHTML = `<h2 class="text-xl font-bold mb-2 text-orange-400">${title}</h2>`;
    return div;
  }

  function createButton(text, onclick) {
    const btn = document.createElement('button');
    btn.textContent = text;
    btn.className = "px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700";
    btn.onclick = onclick;
    return btn;
  }

  function makeInput(value = "", placeholder = "") {
    const input = document.createElement('input');
    input.type = "text";
    input.value = value;
    input.placeholder = placeholder;
    input.className = "w-full p-2 rounded bg-white dark:bg-zinc-700 border border-gray-300 dark:border-zinc-600";
    return input;
  }

  function addExperience(container, exp = { title: "", company: "", location: "", start: "", end: "", bullets: [] }) {
    const card = document.createElement('div');
    card.className = "space-y-2 bg-stone-100 dark:bg-zinc-700 p-4 rounded";

    card.appendChild(makeInput(exp.title, "Job Title"));
    card.appendChild(makeInput(exp.company, "Company"));
    card.appendChild(makeInput(exp.location, "Location"));
    card.appendChild(makeInput(`${exp.start} - ${exp.end}`, "Start - End"));

    const bulletsList = document.createElement('div');
    (exp.bullets || []).forEach(bullet => {
      bulletsList.appendChild(makeInput(bullet, "Bullet point"));
    });
    card.appendChild(bulletsList);

    const addBullet = createButton("+ Add Bullet", () => {
      bulletsList.appendChild(makeInput("", "Bullet point"));
    });
    card.appendChild(addBullet);

    container.appendChild(card);
  }

  function addSkillGroupFunc(container, skillGroup = { group: "", items: [] }) {
    const groupDiv = document.createElement('div');
    groupDiv.className = "space-y-2 bg-stone-100 dark:bg-zinc-700 p-4 rounded";

    groupDiv.appendChild(makeInput(skillGroup.group, "Skill Group Name"));
    const skillsList = document.createElement('div');
    (skillGroup.items || []).forEach(skill => {
      skillsList.appendChild(makeInput(skill, "Skill"));
    });
    groupDiv.appendChild(skillsList);

    const addSkill = createButton("+ Add Skill", () => {
      skillsList.appendChild(makeInput("", "Skill"));
    });
    groupDiv.appendChild(addSkill);

    container.appendChild(groupDiv);
  }

  function addEduGroupFunc(container, eduGroup = { group: "", items: [] }) {
    const groupDiv = document.createElement('div');
    groupDiv.className = "space-y-2 bg-stone-100 dark:bg-zinc-700 p-4 rounded";

    groupDiv.appendChild(makeInput(eduGroup.group, "Education Group Title"));
    const eduList = document.createElement('div');
    (eduGroup.items || []).forEach(edu => {
      eduList.appendChild(makeInput(`${edu.institution} / ${edu.credential} / ${edu.year}`, "School / Degree / Year"));
    });
    groupDiv.appendChild(eduList);

    const addEntry = createButton("+ Add Entry", () => {
      eduList.appendChild(makeInput("", "School / Degree / Year"));
    });
    groupDiv.appendChild(addEntry);

    container.appendChild(groupDiv);
  }

  // === SAVE FUNCTION ===
  saveBtn.addEventListener('click', async () => {
    const sections = editor.querySelectorAll('.section-card');

    const summary = sections[0].querySelector('input').value.trim();

    const experience = [];
    sections[1].querySelectorAll('div.space-y-2').forEach(card => {
      const inputs = card.querySelectorAll('input');
      experience.push({
        title: inputs[0].value.trim(),
        company: inputs[1].value.trim(),
        location: inputs[2].value.trim(),
        start: (inputs[3].value.split("-")[0] || "").trim(),
        end: (inputs[3].value.split("-")[1] || "").trim(),
        bullets: Array.from(card.querySelectorAll('div input')).slice(4).map(b => b.value.trim())
      });
    });

    const skills = [];
    sections[2].querySelectorAll('div.space-y-2').forEach(group => {
      const inputs = group.querySelectorAll('input');
      skills.push({
        group: inputs[0].value.trim(),
        items: Array.from(inputs).slice(1).map(i => i.value.trim())
      });
    });

    const education = [];
    sections[3].querySelectorAll('div.space-y-2').forEach(group => {
      const inputs = group.querySelectorAll('input');
      education.push({
        group: inputs[0].value.trim(),
        items: Array.from(inputs).slice(1).map(entry => {
          const parts = entry.value.split("/");
          return {
            institution: (parts[0] || "").trim(),
            credential: (parts[1] || "").trim(),
            year: (parts[2] || "").trim()
          };
        })
      });
    });

    const contactInputs = sections[4].querySelectorAll('input');
    const contact = {
      email: contactInputs[0].value.trim(),
      phone: contactInputs[1].value.trim(),
      telegram: contactInputs[2].value.trim(),
      web: contactInputs[3].value.trim()
    };

    try {
      await db.collection('resume').doc('live').set({
        summary,
        experience,
        skills,
        education,
        contact,
        updated: new Date().toISOString()
      });
      alert("Resume saved!");
    } catch (err) {
      console.error("Failed to save:", err);
      alert("Failed to save resume.");
    }
  });
</script>

</body>