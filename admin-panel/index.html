<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Resume Admin Panel</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBYYAjY8Q7RH0jQuMeOmAAp3XPTGLAQr0k",
      authDomain: "code-tools-pastebin.firebaseapp.com",
      projectId: "code-tools-pastebin",
      storageBucket: "code-tools-pastebin.appspot.com",
      messagingSenderId: "1000713658548",
      appId: "1:1000713658548:web:4996a3a58b1f3fd013b7e1"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();
  </script>

  <style>
    body { font-family: sans-serif; background: #e7e5e4; }
    @media (prefers-color-scheme: dark) { body { background: #181818; color: white; } }
  </style>
</head>
<body class="p-6">

  <h1 class="text-3xl font-bold text-center mb-8">Resume Admin Panel</h1>

  <div id="authSection" class="text-center mb-8">
    <button id="googleLogin" class="px-6 py-3 rounded bg-white border border-gray-300 text-black font-bold hover:bg-gray-100 transition flex items-center justify-center gap-2 mx-auto">
      Sign in with Google
    </button>
    <button id="logoutBtn" class="hidden px-4 py-2 bg-red-600 text-white rounded mt-4">Logout</button>
  </div>

  <div id="editor" class="max-w-3xl mx-auto flex flex-col gap-8 hidden">

    <!-- Summary -->
    <section class="bg-white dark:bg-zinc-800 p-6 rounded-lg shadow">
      <h2 class="text-xl font-bold mb-4">Summary</h2>
      <textarea id="summaryInput" rows="5" class="w-full p-3 rounded border"></textarea>
      <button onclick="saveSummary()" class="mt-4 px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">Save Summary</button>
    </section>

    <!-- Contact -->
    <section class="bg-white dark:bg-zinc-800 p-6 rounded-lg shadow">
      <h2 class="text-xl font-bold mb-4">Contact Info</h2>
      <input id="emailInput" type="text" placeholder="Email" class="w-full p-2 mb-2 rounded border">
      <input id="phoneInput" type="text" placeholder="Phone" class="w-full p-2 mb-2 rounded border">
      <input id="linkedinInput" type="text" placeholder="LinkedIn URL" class="w-full p-2 mb-2 rounded border">
      <input id="githubInput" type="text" placeholder="GitHub URL" class="w-full p-2 mb-2 rounded border">
      <button onclick="saveContact()" class="mt-4 px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">Save Contact</button>
    </section>

    <!-- Skills -->
    <section class="bg-white dark:bg-zinc-800 p-6 rounded-lg shadow">
      <h2 class="text-xl font-bold mb-4">Skills</h2>
      <textarea id="skillsInput" rows="4" placeholder="Comma separated skills" class="w-full p-3 rounded border"></textarea>
      <button onclick="saveSkills()" class="mt-4 px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">Save Skills</button>
    </section>

    <!-- Education -->
    <section class="bg-white dark:bg-zinc-800 p-6 rounded-lg shadow">
      <h2 class="text-xl font-bold mb-4">Education</h2>
      <textarea id="educationInput" rows="6" placeholder="One school per line: Name | Degree | Year" class="w-full p-3 rounded border"></textarea>
      <button onclick="saveEducation()" class="mt-4 px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">Save Education</button>
    </section>

    <!-- Experience -->
    <section class="bg-white dark:bg-zinc-800 p-6 rounded-lg shadow">
      <h2 class="text-xl font-bold mb-4">Experience</h2>

      <div class="flex flex-col gap-2 mb-6" id="experienceList">
        <!-- Jobs will load here -->
      </div>

      <h3 class="text-lg font-semibold mt-8 mb-2">Add New Experience</h3>

      <input id="newCompany" type="text" placeholder="Company Name" class="w-full p-2 mb-2 rounded border">
      <input id="newTitle" type="text" placeholder="Job Title" class="w-full p-2 mb-2 rounded border">
      <input id="newStart" type="text" placeholder="Start Date (e.g. Jan 2021)" class="w-full p-2 mb-2 rounded border">
      <input id="newEnd" type="text" placeholder="End Date (e.g. Present)" class="w-full p-2 mb-2 rounded border">
      <textarea id="newDescription" placeholder="Job Description" rows="4" class="w-full p-3 mb-2 rounded border"></textarea>

      <button onclick="addExperience()" class="mt-4 px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">Add Experience</button>
    </section>

  </div>

  <script>
    const googleLogin = document.getElementById('googleLogin');
    const logoutBtn = document.getElementById('logoutBtn');
    const authSection = document.getElementById('authSection');
    const editor = document.getElementById('editor');

    googleLogin.addEventListener('click', async () => {
      const provider = new firebase.auth.GoogleAuthProvider();
      try {
        await auth.signInWithPopup(provider);
      } catch (err) {
        alert('Google sign-in error: ' + err.message);
      }
    });

    logoutBtn.addEventListener('click', async () => {
      await auth.signOut();
    });

    auth.onAuthStateChanged(user => {
      if (user) {
        authSection.classList.add('hidden');
        editor.classList.remove('hidden');
        logoutBtn.classList.remove('hidden');
        loadResumeData();
      } else {
        authSection.classList.remove('hidden');
        editor.classList.add('hidden');
        logoutBtn.classList.add('hidden');
      }
    });

    async function loadResumeData() {
      try {
        const summaryDoc = await db.collection('resume').doc('summary').get();
        if (summaryDoc.exists) {
          document.getElementById('summaryInput').value = summaryDoc.data().text || '';
        }

        const contactDoc = await db.collection('resume').doc('contact').get();
        if (contactDoc.exists) {
          const data = contactDoc.data();
          document.getElementById('emailInput').value = data.email || '';
          document.getElementById('phoneInput').value = data.phone || '';
          document.getElementById('linkedinInput').value = data.linkedin || '';
          document.getElementById('githubInput').value = data.github || '';
        }

        const skillsDoc = await db.collection('resume').doc('skills').get();
        if (skillsDoc.exists) {
          document.getElementById('skillsInput').value = (skillsDoc.data().skills || []).join(', ');
        }

        const educationDoc = await db.collection('resume').doc('education').get();
        if (educationDoc.exists) {
          const lines = (educationDoc.data().schools || []).map(s => `${s.name} | ${s.degree} | ${s.year}`);
          document.getElementById('educationInput').value = lines.join('\n');
        }

        await loadExperience();
      } catch (err) {
        console.error('Failed to load resume:', err.message);
      }
    }

    async function saveSummary() {
      const text = document.getElementById('summaryInput').value.trim();
      await db.collection('resume').doc('summary').set({ text });
      alert('Summary saved!');
    }

    async function saveContact() {
      const email = document.getElementById('emailInput').value.trim();
      const phone = document.getElementById('phoneInput').value.trim();
      const linkedin = document.getElementById('linkedinInput').value.trim();
      const github = document.getElementById('githubInput').value.trim();
      await db.collection('resume').doc('contact').set({ email, phone, linkedin, github });
      alert('Contact info saved!');
    }

    async function saveSkills() {
      const skillsRaw = document.getElementById('skillsInput').value.trim();
      const skills = skillsRaw.split(',').map(s => s.trim()).filter(Boolean);
      await db.collection('resume').doc('skills').set({ skills });
      alert('Skills saved!');
    }

    async function saveEducation() {
      const raw = document.getElementById('educationInput').value.trim();
      const lines = raw.split('\n').map(line => {
        const [name, degree, year] = line.split('|').map(x => x.trim());
        return { name, degree, year };
      }).filter(e => e.name && e.degree && e.year);
      await db.collection('resume').doc('education').set({ schools: lines });
      alert('Education saved!');
    }

    async function loadExperience() {
      const experienceList = document.getElementById('experienceList');
      experienceList.innerHTML = '';

      const snapshot = await db.collection('resume').doc('experience').collection('jobs').orderBy('start', 'desc').get();
      snapshot.forEach(doc => {
        const job = doc.data();
        const card = document.createElement('div');
        card.className = 'p-4 bg-gray-100 dark:bg-zinc-700 rounded flex flex-col gap-1 relative';

        const title = document.createElement('div');
        title.className = 'font-bold';
        title.textContent = `${job.title} at ${job.company}`;

        const dates = document.createElement('div');
        dates.className = 'text-xs opacity-70';
        dates.textContent = `${job.start} - ${job.end}`;

        const desc = document.createElement('div');
        desc.className = 'text-sm mt-2';
        desc.textContent = job.description;

        const deleteBtn = document.createElement('button');
        deleteBtn.className = 'absolute top-2 right-2 text-red-600 text-xs hover:underline';
        deleteBtn.textContent = 'Delete';
        deleteBtn.onclick = () => deleteExperience(doc.id);

        card.appendChild(title);
        card.appendChild(dates);
        card.appendChild(desc);
        card.appendChild(deleteBtn);

        experienceList.appendChild(card);
      });
    }

    async function addExperience() {
      const company = document.getElementById('newCompany').value.trim();
      const title = document.getElementById('newTitle').value.trim();
      const start = document.getElementById('newStart').value.trim();
      const end = document.getElementById('newEnd').value.trim();
      const description = document.getElementById('newDescription').value.trim();

      if (!company || !title || !start || !end || !description) {
        alert('Please fill in all experience fields.');
        return;
      }

      await db.collection('resume').doc('experience').collection('jobs').add({
        company, title, start, end, description
      });

      document.getElementById('newCompany').value = '';
      document.getElementById('newTitle').value = '';
      document.getElementById('newStart').value = '';
      document.getElementById('newEnd').value = '';
      document.getElementById('newDescription').value = '';

      alert('Experience added!');
      loadExperience();
    }

    async function deleteExperience(id) {
      if (!confirm('Delete this experience?')) return;

      await db.collection('resume').doc('experience').collection('jobs').doc(id).delete();
      alert('Experience deleted!');
      loadExperience();
    }
  </script>

</body>
</html> 