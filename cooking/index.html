<!DOCTYPE html>
<html lang="en" class="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>D’s Timers</title>
  <link rel="manifest" href="manifest.json">
  <style>
    :root {
      --bg: #f9fafb;
      --text: #111827;
      --card: #ffffff;
      --primary: #4f46e5;
      --primary-hover: #4338ca;
      --shadow: rgba(0,0,0,0.08);
    }
    .dark {
      --bg: #111827;
      --text: #f9fafb;
      --card: #1f2937;
      --primary: #6366f1;
      --primary-hover: #818cf8;
      --shadow: rgba(0,0,0,0.4);
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", sans-serif;
      background: var(--bg);
      color: var(--text);
      margin: 0;
      padding: 1rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1.5rem;
      min-height: 100vh;
      transition: background 0.3s, color 0.3s;
    }
    h1 {
      font-size: 2.2rem;
      font-weight: bold;
      margin: 1rem 0 0.5rem;
    }
    #top-bar {
      width: 100%;
      max-width: 600px;
      display: flex;
      gap: 0.5rem;
      align-items: center;
      flex-wrap: wrap;
    }
    #searchInput, #inHouseToggle, #addTimer {
      padding: 0.6rem;
      border: 1px solid #ccc;
      border-radius: 0.5rem;
      font-size: 1rem;
      cursor: pointer;
    }
    #buttons {
      width: 100%;
      max-width: 900px;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 1rem;
    }
    .food-card {
      background: var(--card);
      box-shadow: 0 2px 6px var(--shadow);
      border-radius: 0.75rem;
      padding: 1rem;
      text-align: center;
      cursor: pointer;
      transition: transform 0.2s;
      position: relative;
    }
    .food-card:hover {
      transform: scale(1.03);
    }
    .food-name {
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 0.3rem;
    }
    .food-category {
      font-size: 0.9rem;
      opacity: 0.7;
    }
    .edit-btn {
      position: absolute;
      top: 8px;
      right: 8px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 50%;
      width: 28px;
      height: 28px;
      font-size: 16px;
      cursor: pointer;
    }
    #modal, #overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.6);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 999;
    }
    .modal-content {
      background: var(--card);
      padding: 2rem;
      border-radius: 1rem;
      width: 90%;
      max-width: 400px;
      text-align: center;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    .modal-content input, .modal-content textarea {
      padding: 0.5rem;
      border: 1px solid #ccc;
      border-radius: 0.5rem;
      font-size: 1rem;
    }
    .modal-content button {
      padding: 0.75rem;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 0.5rem;
      font-size: 1rem;
      cursor: pointer;
    }
    .timer-fullscreen {
      background: var(--bg);
      color: var(--text);
      font-size: 5rem;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 2rem;
    }
    #cancelBtn {
      margin-top: 2rem;
      background: #ef4444;
    }
    label {
      font-size: 0.9rem;
      text-align: left;
    }
  </style>
</head>
<body>

<h1>D’s Timers</h1>

<div id="top-bar">
  <input type="text" id="searchInput" placeholder="Search...">
  <button id="inHouseToggle">Show In-House</button>
  <button id="addTimer">➕ Add Timer</button>
</div>

<div id="buttons"></div>

<div id="modal">
  <div class="modal-content">
    <h2 id="modalTitle">Add/Edit Timer</h2>
    <input id="modalName" placeholder="Food Name">
    <input id="modalCategory" placeholder="Category">
    <input id="modalMinutes" type="number" placeholder="Minutes">
    <textarea id="modalTip" placeholder="Cooking Tip (optional)"></textarea>
    <label><input type="checkbox" id="modalInHouse"> In House</label>
    <button id="saveBtn">Save</button>
    <button id="deleteBtn" style="background: #ef4444; display: none;">Delete</button>
    <button id="cancelModal" style="background: gray;">Cancel</button>
  </div>
</div>

<div id="overlay">
  <div class="timer-fullscreen">
    <div id="overlayTimer">0:00</div>
    <button id="cancelBtn">Cancel</button>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

<script>
// firebase init
const firebaseConfig = {
  apiKey: "AIzaSyBYYAjY8Q7RH0jQuMeOmAAp3XPTGLAQr0k",
  authDomain: "code-tools-pastebin.firebaseapp.com",
  projectId: "code-tools-pastebin",
  storageBucket: "code-tools-pastebin.appspot.com",
  messagingSenderId: "1000713658548",
  appId: "1:1000713658548:web:4996a3a58b1f3fd013b7e1"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// elements
const buttonsContainer = document.getElementById('buttons');
const searchInput = document.getElementById('searchInput');
const inHouseToggle = document.getElementById('inHouseToggle');
const addTimer = document.getElementById('addTimer');
const modal = document.getElementById('modal');
const modalTitle = document.getElementById('modalTitle');
const modalName = document.getElementById('modalName');
const modalCategory = document.getElementById('modalCategory');
const modalMinutes = document.getElementById('modalMinutes');
const modalTip = document.getElementById('modalTip');
const modalInHouse = document.getElementById('modalInHouse');
const saveBtn = document.getElementById('saveBtn');
const deleteBtn = document.getElementById('deleteBtn');
const cancelModal = document.getElementById('cancelModal');
const overlay = document.getElementById('overlay');
const overlayTimer = document.getElementById('overlayTimer');
const cancelBtn = document.getElementById('cancelBtn');

let allFoods = [];
let showInHouse = false;
let currentFoodId = null;
let currentTimer = null;
let countdownInterval = null;

// theme
function applyTheme() {
  if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
    document.documentElement.classList.add('dark');
    document.documentElement.classList.remove('light');
  } else {
    document.documentElement.classList.add('light');
    document.documentElement.classList.remove('dark');
  }
}
applyTheme();
window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', applyTheme);

// render
function renderFoods(filter = '') {
  buttonsContainer.innerHTML = "";
  allFoods
    .filter(f => f.data.name.toLowerCase().includes(filter.toLowerCase()))
    .filter(f => !showInHouse || f.data.inHouse)
    .forEach(({id, data}) => {
      const card = document.createElement('div');
      card.className = 'food-card';
      card.innerHTML = `
        <div class="food-name">${data.name}</div>
        <div class="food-category">${data.category || 'Uncategorized'}</div>
        <button class="edit-btn">✏️</button>
      `;
      card.querySelector('.edit-btn').addEventListener('click', (e) => {
        e.stopPropagation();
        openEditModal(id, data);
      });
      card.addEventListener('click', () => startTimer(data.minutes));
      buttonsContainer.appendChild(card);
    });
}

// load
function loadFoods() {
  db.collection('cooking_timers').onSnapshot(snapshot => {
    allFoods = [];
    snapshot.forEach(doc => {
      allFoods.push({ id: doc.id, data: doc.data() });
    });
    renderFoods(searchInput.value);
  });
}

// modal
function openEditModal(id, data) {
  currentFoodId = id;
  modalTitle.textContent = "Edit Timer";
  modalName.value = data.name;
  modalCategory.value = data.category || '';
  modalMinutes.value = data.minutes || 0;
  modalTip.value = data.tip || '';
  modalInHouse.checked = data.inHouse || false;
  deleteBtn.style.display = "block";
  modal.style.display = "flex";
}

function openNewModal() {
  currentFoodId = null;
  modalTitle.textContent = "Add New Timer";
  modalName.value = '';
  modalCategory.value = '';
  modalMinutes.value = '';
  modalTip.value = '';
  modalInHouse.checked = false;
  deleteBtn.style.display = "none";
  modal.style.display = "flex";
}

// start timer
function startTimer(minutes) {
  if (!minutes) return;
  if (navigator.vibrate) navigator.vibrate(100);
  overlay.style.display = "flex";
  let seconds = minutes * 60;
  updateOverlay(seconds);

  countdownInterval = setInterval(() => {
    seconds--;
    updateOverlay(seconds);
    if (seconds <= 0) {
      clearInterval(countdownInterval);
      overlayTimer.textContent = "DONE!";
    }
  }, 1000);
}

function updateOverlay(seconds) {
  const m = Math.floor(seconds / 60);
  const s = seconds % 60;
  overlayTimer.textContent = `${m}:${s.toString().padStart(2, '0')}`;
}

function cancelTimer() {
  clearInterval(countdownInterval);
  overlay.style.display = "none";
}

// actions
searchInput.addEventListener('input', () => renderFoods(searchInput.value));
inHouseToggle.addEventListener('click', () => {
  showInHouse = !showInHouse;
  inHouseToggle.textContent = showInHouse ? "Showing In-House" : "Show In-House";
  renderFoods(searchInput.value);
});
addTimer.addEventListener('click', openNewModal);
cancelModal.addEventListener('click', () => modal.style.display = "none");
cancelBtn.addEventListener('click', cancelTimer);

saveBtn.addEventListener('click', () => {
  const food = {
    name: modalName.value.trim(),
    category: modalCategory.value.trim(),
    minutes: parseInt(modalMinutes.value.trim()),
    tip: modalTip.value.trim(),
    inHouse: modalInHouse.checked
  };
  if (currentFoodId) {
    db.collection('cooking_timers').doc(currentFoodId).update(food);
  } else {
    db.collection('cooking_timers').add(food);
  }
  modal.style.display = "none";
});

deleteBtn.addEventListener('click', () => {
  if (confirm("Are you sure you want to delete this timer?")) {
    db.collection('cooking_timers').doc(currentFoodId).delete();
    modal.style.display = "none";
  }
});

// init
loadFoods();
</script>

</body>
</html>