<!DOCTYPE html>
<html lang="en" class="bg-gray-900 text-white">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Flight Tracker</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .card.dragging {
      opacity: 0.4;
    }
    .swipe-wrapper {
      transition: transform 0.3s ease;
    }
    .editing {
      outline: 2px dashed #fff;
    }
  </style>
</head>
<body class="flex flex-col h-screen font-mono">
  <textarea id="input" placeholder="Paste flight data here..." class="w-full h-24 p-2 bg-gray-800 text-white resize-none text-lg"></textarea>
  <div class="flex gap-2">
    <button onclick="createCards()" class="flex-1 py-3 text-lg bg-blue-600 hover:bg-blue-700">Generate Cards</button>
    <button onclick="clearAll()" class="flex-1 py-3 text-lg bg-red-600 hover:bg-red-700">Clear All</button>
  </div>
  <div class="flex-1 flex gap-4 p-2 overflow-hidden">
    <div class="flex flex-col flex-1 bg-gray-800 rounded-lg p-2">
      <div class="flex justify-between items-center mb-2">
        <h2 class="text-xl font-bold">Active Flights</h2>
        <select onchange="sortColumn('activeColumn', this.value)" class="bg-gray-700 text-white px-2 py-1 rounded">
          <option value="custom">Custom</option>
          <option value="az">A-Z</option>
        </select>
      </div>
      <div id="activeColumn" class="flex-1 overflow-y-auto space-y-2 p-1" ondragover="allowDrop(event)" ondrop="drop(event, 'activeColumn')"></div>
    </div>

    <div class="flex flex-col flex-1 bg-gray-800 rounded-lg p-2">
      <div class="flex justify-between items-center mb-2">
        <h2 class="text-xl font-bold">Completed</h2>
        <select onchange="sortColumn('completeColumn', this.value)" class="bg-gray-700 text-white px-2 py-1 rounded">
          <option value="custom">Custom</option>
          <option value="az">A-Z</option>
        </select>
      </div>
      <div id="completeColumn" class="flex-1 overflow-y-auto space-y-2 p-1" ondragover="allowDrop(event)" ondrop="drop(event, 'completeColumn')"></div>
    </div>
  </div>

  <script>
    let dragged = null;
    let touchStartX = 0;
    let activeWrapper = null;
    let tapTimeout = null;

    function classifyCard(text) {
      if (text.includes("_TF_")) return "bg-red-700";
      if (text.includes("_QT_")) return "bg-green-700";
      return "bg-gray-700";
    }

    function createCard(text) {
      const wrapper = document.createElement("div");
      wrapper.className = "relative overflow-hidden rounded swipe-wrapper";
      wrapper.dataset.id = crypto.randomUUID();

      const container = document.createElement("div");
      container.className = `card ${classifyCard(text)} text-white text-3xl font-bold px-4 py-4 rounded cursor-grab whitespace-pre-wrap`;
      container.draggable = true;
      container.textContent = text;

      // Drag and drop
      container.ondragstart = () => {
        dragged = wrapper;
        container.classList.add("dragging");
      };
      container.ondragend = () => {
        container.classList.remove("dragging");
        dragged = null;
        saveState();
      };
      container.ondragover = e => e.preventDefault();
      container.ondrop = e => {
        e.preventDefault();
        if (dragged && dragged !== wrapper) {
          container.parentNode.insertBefore(dragged, wrapper.nextSibling);
          saveState();
        }
      };

      // Swipe handling
      container.ontouchstart = e => {
        touchStartX = e.changedTouches[0].screenX;
        activeWrapper = wrapper;
      };
      container.ontouchend = e => {
        const deltaX = e.changedTouches[0].screenX - touchStartX;
        if (deltaX < -80) {
          wrapper.style.transform = "translateX(-100px)";
        } else if (deltaX > 80) {
          wrapper.style.transform = "translateX(100px)";
        } else {
          wrapper.style.transform = "translateX(0)";
        }
      };

      // Double tap to edit
      container.ondblclick = () => {
        container.contentEditable = true;
        container.focus();
        container.classList.add("editing");
      };
      container.onblur = () => {
        container.contentEditable = false;
        container.classList.remove("editing");
        saveState();
      };

      // Buttons
      const delBtn = document.createElement("button");
      delBtn.textContent = "✕";
      delBtn.onclick = () => {
        wrapper.remove();
        saveState();
      };
      delBtn.className = "absolute right-2 top-1/2 -translate-y-1/2 bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded z-10";

      const doneBtn = document.createElement("button");
      doneBtn.textContent = "✓";
      doneBtn.onclick = () => {
        document.getElementById("completeColumn").appendChild(wrapper);
        wrapper.style.transform = "translateX(0)";
        saveState();
      };
      doneBtn.className = "absolute left-2 top-1/2 -translate-y-1/2 bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded z-10";

      wrapper.appendChild(container);
      wrapper.appendChild(doneBtn);
      wrapper.appendChild(delBtn);
      return wrapper;
    }

    function createCards() {
      const lines = document.getElementById("input").value.trim().split("\n");
      const active = document.getElementById("activeColumn");
      const complete = document.getElementById("completeColumn");
      active.innerHTML = "";
      complete.innerHTML = "";

      lines.forEach(line => {
        if (!line.trim()) return;
        active.appendChild(createCard(line.trim()));
      });

      saveState();
    }

    function allowDrop(e) {
      e.preventDefault();
    }

    function drop(e, columnId) {
      e.preventDefault();
      const col = document.getElementById(columnId);
      if (dragged && col) col.appendChild(dragged);
      saveState();
    }

    function saveState() {
      const active = [...document.querySelectorAll("#activeColumn .card")].map(c => c.textContent);
      const complete = [...document.querySelectorAll("#completeColumn .card")].map(c => c.textContent);
      localStorage.setItem("flights_active", JSON.stringify(active));
      localStorage.setItem("flights_complete", JSON.stringify(complete));
    }

    function loadState() {
      const activeCards = JSON.parse(localStorage.getItem("flights_active") || "[]");
      const completeCards = JSON.parse(localStorage.getItem("flights_complete") || "[]");
      const active = document.getElementById("activeColumn");
      const complete = document.getElementById("completeColumn");

      active.innerHTML = "";
      complete.innerHTML = "";

      activeCards.forEach(text => active.appendChild(createCard(text)));
      completeCards.forEach(text => complete.appendChild(createCard(text)));
    }

    function clearAll() {
      if (confirm("Clear all cards?")) {
        localStorage.clear();
        document.getElementById("activeColumn").innerHTML = "";
        document.getElementById("completeColumn").innerHTML = "";
      }
    }

    function sortColumn(id, mode) {
      const col = document.getElementById(id);
      const wrappers = [...col.children];
      if (mode === "az") {
        wrappers.sort((a, b) =>
          a.querySelector(".card").textContent.localeCompare(b.querySelector(".card").textContent)
        );
      }
      col.innerHTML = "";
      wrappers.forEach(w => col.appendChild(w));
      saveState();
    }

    loadState();
  </script>
</body>
</html>