<!DOCTYPE html>
<html lang="en" class="bg-gray-900 text-white">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Flight Tracker</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .editing {
      outline: 2px dashed white;
      outline-offset: 2px;
      background-color: #1e293b;
    }
    .dragging {
      opacity: 0.5;
    }
  </style>
</head>
<body class="flex flex-col h-screen font-mono text-xl">
  <textarea id="input" placeholder="Paste flight data here..." class="w-full h-24 p-2 bg-gray-800 text-white resize-none text-lg"></textarea>
  <div class="flex gap-2">
    <button onclick="createCards()" class="flex-1 py-3 bg-blue-600 hover:bg-blue-700">Generate Cards</button>
    <button onclick="clearAll()" class="flex-1 py-3 bg-red-600 hover:bg-red-700">Clear All</button>
  </div>
  <div class="flex-1 flex gap-4 p-2 overflow-hidden">
    <!-- Active Column -->
    <div class="flex flex-col flex-1 bg-gray-800 rounded-lg p-2">
      <div class="flex justify-between items-center mb-2">
        <h2 class="text-lg font-bold">Active Flights</h2>
        <select onchange="toggleSort('activeColumn', this.value)" class="bg-gray-700 text-white px-2 py-1 rounded">
          <option value="manual">Manual</option>
          <option value="az">A-Z</option>
        </select>
      </div>
      <div id="activeColumn" class="flex-1 overflow-y-auto space-y-3 p-1" ondragover="allowDrop(event)" ondrop="drop(event, 'activeColumn')"></div>
    </div>

    <!-- Completed Column -->
    <div class="flex flex-col flex-1 bg-gray-800 rounded-lg p-2">
      <div class="flex justify-between items-center mb-2">
        <h2 class="text-lg font-bold">Completed</h2>
        <select onchange="toggleSort('completeColumn', this.value)" class="bg-gray-700 text-white px-2 py-1 rounded">
          <option value="manual">Manual</option>
          <option value="az">A-Z</option>
        </select>
      </div>
      <div id="completeColumn" class="flex-1 overflow-y-auto space-y-3 p-1" ondragover="allowDrop(event)" ondrop="drop(event, 'completeColumn')"></div>
    </div>
  </div>

  <script>
    let dragged = null;
    let manualOrder = { activeColumn: [], completeColumn: [] };
    let currentSort = { activeColumn: "manual", completeColumn: "manual" };

    function classify(text) {
      return text.includes("_TF_") ? "bg-red-700" :
             text.includes("_QT_") ? "bg-green-700" : "bg-gray-700";
    }

    function createCard(text, column = "activeColumn") {
      const card = document.createElement("div");
      card.className = `card ${classify(text)} text-white text-3xl font-bold px-4 py-5 rounded cursor-move`;
      card.textContent = text;
      card.draggable = true;

      // Drag logic
      card.ondragstart = () => {
        dragged = card;
        card.classList.add("dragging");
      };
      card.ondragend = () => {
        dragged = null;
        card.classList.remove("dragging");
        saveManualOrder();
      };

      // Drop logic for inside cards
      card.ondragover = e => e.preventDefault();
      card.ondrop = e => {
        e.preventDefault();
        if (dragged && dragged !== card) {
          card.parentNode.insertBefore(dragged, card.nextSibling);
          saveManualOrder();
        }
      };

      // Double-tap to edit
      let lastTap = 0;
      card.onclick = () => {
        const now = Date.now();
        if (now - lastTap < 300) {
          card.contentEditable = true;
          card.classList.add("editing");
          card.focus();
          const range = document.createRange();
          range.selectNodeContents(card);
          const sel = window.getSelection();
          sel.removeAllRanges();
          sel.addRange(range);
        }
        lastTap = now;
      };
      card.onblur = () => {
        if (card.isContentEditable) {
          card.contentEditable = false;
          card.classList.remove("editing");
          saveManualOrder();
        }
      };
      card.onkeydown = (e) => {
        if (e.key === "Enter") {
          e.preventDefault();
          card.blur();
        }
      };

      manualOrder[column].push(card);
      return card;
    }

    function allowDrop(e) {
      e.preventDefault();
    }

    function drop(e, columnId) {
      e.preventDefault();
      if (dragged) {
        document.getElementById(columnId).appendChild(dragged);
        saveManualOrder();
      }
    }

    function toggleSort(columnId, mode) {
      currentSort[columnId] = mode;
      const col = document.getElementById(columnId);
      if (mode === "az") {
        const sorted = [...col.children].sort((a, b) =>
          a.textContent.localeCompare(b.textContent)
        );
        col.innerHTML = "";
        sorted.forEach(c => col.appendChild(c));
      } else {
        col.innerHTML = "";
        manualOrder[columnId].forEach(c => col.appendChild(c));
      }
    }

    function saveManualOrder() {
      ["activeColumn", "completeColumn"].forEach(id => {
        const col = document.getElementById(id);
        manualOrder[id] = [...col.children];
        const values = manualOrder[id].map(c => c.textContent);
        localStorage.setItem("order_" + id, JSON.stringify(values));
      });
    }

    function loadManualOrder() {
      ["activeColumn", "completeColumn"].forEach(id => {
        const col = document.getElementById(id);
        manualOrder[id] = [];
        col.innerHTML = "";
        const values = JSON.parse(localStorage.getItem("order_" + id) || "[]");
        values.forEach(text => {
          const card = createCard(text, id);
          col.appendChild(card);
        });
      });
    }

    function createCards() {
      const lines = document.getElementById("input").value.trim().split("\n");
      const active = document.getElementById("activeColumn");
      const complete = document.getElementById("completeColumn");
      active.innerHTML = "";
      complete.innerHTML = "";
      manualOrder = { activeColumn: [], completeColumn: [] };

      lines.forEach(line => {
        if (!line.trim()) return;
        const card = createCard(line.trim(), "activeColumn");
        active.appendChild(card);
      });

      saveManualOrder();
    }

    function clearAll() {
      if (confirm("Clear all cards?")) {
        localStorage.clear();
        document.getElementById("activeColumn").innerHTML = "";
        document.getElementById("completeColumn").innerHTML = "";
        manualOrder = { activeColumn: [], completeColumn: [] };
      }
    }

    loadManualOrder();
  </script>
</body>
</html>