<!DOCTYPE html>
<html lang="en" class="bg-gray-900 text-white">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Flight Tracker</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .card-inner {
      transition: transform 0.2s ease;
    }
    .editing {
      outline: 2px dashed #fff;
      outline-offset: 2px;
      background-color: #1e293b;
    }
    .card {
      touch-action: pan-y;
      overflow: hidden;
    }
    .action-buttons {
      position: absolute;
      top: 0;
      bottom: 0;
      display: flex;
      width: 100%;
      justify-content: space-between;
      pointer-events: none;
    }
    .action-buttons button {
      pointer-events: auto;
    }
  </style>
</head>
<body class="flex flex-col h-screen font-mono text-xl">
  <textarea id="input" placeholder="Paste flight data here..." class="w-full h-24 p-2 bg-gray-800 text-white resize-none text-lg"></textarea>
  <div class="flex gap-2">
    <button onclick="createCards()" class="flex-1 py-3 bg-blue-600 hover:bg-blue-700">Generate Cards</button>
    <button onclick="clearAll()" class="flex-1 py-3 bg-red-600 hover:bg-red-700">Clear All</button>
  </div>
  <div class="flex-1 flex gap-4 p-2 overflow-hidden">
    <div class="flex flex-col flex-1 bg-gray-800 rounded-lg p-2">
      <h2 class="text-lg font-bold text-center mb-2">Active Flights</h2>
      <div id="activeColumn" class="flex-1 overflow-y-auto space-y-3 p-1" ondragover="allowDrop(event)" ondrop="drop(event, 'activeColumn')"></div>
    </div>
    <div class="flex flex-col flex-1 bg-gray-800 rounded-lg p-2">
      <h2 class="text-lg font-bold text-center mb-2">Completed</h2>
      <div id="completeColumn" class="flex-1 overflow-y-auto space-y-3 p-1" ondragover="allowDrop(event)" ondrop="drop(event, 'completeColumn')"></div>
    </div>
  </div>

  <script>
    let dragged = null;
    let tapTimeout = null;

    function classify(text) {
      return text.includes("_TF_") ? "bg-red-700" :
             text.includes("_QT_") ? "bg-green-700" : "bg-gray-700";
    }

    function createCard(text) {
      const wrapper = document.createElement("div");
      wrapper.className = "relative card";
      wrapper.draggable = true;

      const bgActions = document.createElement("div");
      bgActions.className = "action-buttons px-3";
      bgActions.innerHTML = `
        <button class="bg-green-600 hover:bg-green-700 px-3 py-2 rounded text-white" onclick="completeCard(this)">Complete</button>
        <button class="bg-red-600 hover:bg-red-700 px-3 py-2 rounded text-white" onclick="deleteCard(this)">Delete</button>
      `;

      const inner = document.createElement("div");
      inner.className = `card-inner ${classify(text)} text-white text-3xl font-bold px-4 py-5 rounded`;
      inner.textContent = text;

      // Drag reorder
      wrapper.ondragstart = () => {
        dragged = wrapper;
        inner.classList.add("opacity-50");
      };
      wrapper.ondragend = () => {
        dragged = null;
        inner.classList.remove("opacity-50");
      };
      wrapper.ondragover = e => e.preventDefault();
      wrapper.ondrop = e => {
        e.preventDefault();
        if (dragged && dragged !== wrapper) {
          wrapper.parentNode.insertBefore(dragged, wrapper.nextSibling);
          saveState();
        }
      };

      // Double tap to edit
      let lastTap = 0;
      inner.onclick = () => {
        const now = Date.now();
        if (now - lastTap < 300) {
          inner.contentEditable = true;
          inner.classList.add("editing");
          inner.focus();
          const range = document.createRange();
          range.selectNodeContents(inner);
          const sel = window.getSelection();
          sel.removeAllRanges();
          sel.addRange(range);
        }
        lastTap = now;
      };
      inner.onblur = () => {
        if (inner.isContentEditable) {
          inner.contentEditable = false;
          inner.classList.remove("editing");
          saveState();
        }
      };
      inner.onkeydown = (e) => {
        if (e.key === "Enter") {
          e.preventDefault();
          inner.blur();
        }
      };

      // Swipe logic
      let startX = 0;
      let currentX = 0;
      let swiping = false;

      inner.addEventListener("touchstart", (e) => {
        startX = e.touches[0].clientX;
        swiping = true;
      });
      inner.addEventListener("touchmove", (e) => {
        if (!swiping) return;
        currentX = e.touches[0].clientX;
        const deltaX = currentX - startX;
        inner.style.transform = `translateX(${deltaX}px)`;
      });
      inner.addEventListener("touchend", () => {
        const deltaX = currentX - startX;
        swiping = false;
        if (deltaX < -100) {
          inner.style.transform = "translateX(-100px)";
        } else if (deltaX > 100) {
          inner.style.transform = "translateX(100px)";
        } else {
          inner.style.transform = "translateX(0)";
        }
      });

      wrapper.appendChild(bgActions);
      wrapper.appendChild(inner);
      return wrapper;
    }

    function completeCard(btn) {
      const card = btn.closest(".card");
      document.getElementById("completeColumn").appendChild(card);
      card.querySelector(".card-inner").style.transform = "translateX(0)";
      saveState();
    }

    function deleteCard(btn) {
      btn.closest(".card").remove();
      saveState();
    }

    function createCards() {
      const input = document.getElementById("input").value.trim().split("\n");
      const col = document.getElementById("activeColumn");
      col.innerHTML = "";
      input.forEach(line => {
        if (line.trim()) col.appendChild(createCard(line.trim()));
      });
      saveState();
    }

    function drop(e, columnId) {
      e.preventDefault();
      if (dragged) {
        document.getElementById(columnId).appendChild(dragged);
        saveState();
      }
    }

    function allowDrop(e) {
      e.preventDefault();
    }

    function saveState() {
      localStorage.setItem("flights_active", JSON.stringify(
        [...document.querySelectorAll("#activeColumn .card-inner")].map(c => c.textContent)
      ));
      localStorage.setItem("flights_complete", JSON.stringify(
        [...document.querySelectorAll("#completeColumn .card-inner")].map(c => c.textContent)
      ));
    }

    function loadState() {
      const actives = JSON.parse(localStorage.getItem("flights_active") || "[]");
      const completes = JSON.parse(localStorage.getItem("flights_complete") || "[]");

      const activeCol = document.getElementById("activeColumn");
      const completeCol = document.getElementById("completeColumn");
      activeCol.innerHTML = "";
      completeCol.innerHTML = "";

      actives.forEach(t => activeCol.appendChild(createCard(t)));
      completes.forEach(t => completeCol.appendChild(createCard(t)));
    }

    function clearAll() {
      if (confirm("Clear everything?")) {
        localStorage.clear();
        document.getElementById("activeColumn").innerHTML = "";
        document.getElementById("completeColumn").innerHTML = "";
      }
    }

    loadState();
  </script>
</body>
</html>