<!DOCTYPE html>
<html lang="en" class="bg-gray-900 text-white">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Flight Tracker</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="p-4 font-sans text-white bg-gray-900">
  <h1 class="text-2xl font-bold mb-4">Ramp Flight Tracker</h1>
  <div class="mb-4">
    <button id="toggleHide" class="px-4 py-2 bg-cyan-700 rounded hover:bg-cyan-600 hidden md:inline-block">
      Hide Completed
    </button>
  </div>
  <div id="flightList" class="space-y-3"></div>

  <script>
    const rawFlights = `
1608_2092_CLT_QT_321K_923_B8
1617_2121_DCA_QT_319W_733_B6
1637_1245_LAX_QT_738R_3MH_B10
1742_3248_PHL_QT_A320_117_nan
1816_2863_MIA_QT_H319_742_B6
1823_1868_DFW_TF_738R_742_B10
1831_4349_DFW_QT_CR7_996_B6
1836_4742_PHL_TF_CR7_774_B10
1843_347_PHL_TF_CR7_122_B8
1850_1702_DFW_TF_738R_933_B8
1857_1761_DFW_TF_738R_879_B10
1905_2871_CLT_QT_E75L_907_B8
1923_2963_DFW_QT_E75L_958_B10
2002_4410_DFW_QT_E75L_978_B6
2025_4410_LGA_QT_CR7_981_B6
2042_4613_DCA_QT_CR7_978_B8
2045_4742_PHL_TF_CR7_978_B6
2134_1962_DFW_TF_738R_841_B6
`.trim().split('\n').map(line => {
      const [eta, flight, origin, status, type, tail, gate] = line.split('_');
      return { id: flight, eta, flight, origin, status, type, tail, gate, serviced: false };
    });

    const flightList = document.getElementById("flightList");
    const hideBtn = document.getElementById("toggleHide");
    let hideCompleted = false;

    // Load state from localStorage
    function loadState() {
      const saved = JSON.parse(localStorage.getItem("flightProgress") || "{}");
      rawFlights.forEach(f => {
        f.serviced = saved[f.id] || false;
      });
    }

    // Save state to localStorage
    function saveState() {
      const saved = {};
      rawFlights.forEach(f => {
        if (f.serviced) saved[f.id] = true;
      });
      localStorage.setItem("flightProgress", JSON.stringify(saved));
    }

    function renderFlights() {
      flightList.innerHTML = "";
      rawFlights.forEach(f => {
        if (hideCompleted && f.serviced) return;
        const div = document.createElement("div");
        div.className = `p-3 rounded border flex justify-between items-center transition-all ${
          f.serviced ? 'bg-green-800 border-green-500 opacity-70' : 'bg-gray-800 border-gray-600'
        }`;
        div.innerHTML = `
          <div>
            <div class="font-bold text-lg">${f.flight} (${f.origin})</div>
            <div class="text-sm">ETA: ${f.eta} | Gate: ${f.gate || '--'} | A/C: ${f.type} | Tail: ${f.tail}</div>
          </div>
          <button class="ml-4 px-3 py-1 rounded bg-cyan-700 hover:bg-cyan-600">
            ${f.serviced ? 'Undo' : 'Serviced'}
          </button>
        `;
        div.querySelector("button").onclick = () => {
          f.serviced = !f.serviced;
          saveState();
          renderFlights();
        };
        flightList.appendChild(div);
      });
    }

    hideBtn.onclick = () => {
      hideCompleted = !hideCompleted;
      hideBtn.textContent = hideCompleted ? "Show All" : "Hide Completed";
      renderFlights();
    };

    // Mobile: hide the button
    if (window.innerWidth < 768) {
      hideBtn.style.display = "none";
    }

    loadState();
    renderFlights();
  </script>
</body>
</html>